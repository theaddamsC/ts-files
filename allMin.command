read -p "幾堂課？" COURSENUM;for((k=1;k<=${COURSENUM};k=k+1));do read -p "課程${k} 名稱？" COURSENAME[k];read -p "課程${k} 集數？" COURSEEP[k];read -p "課程${k} 編號？" COURSEID[k];done;read -p "是否在下載完後自動關機(y/n)？" AUTOSHOOTDOWN;for((k=1;k<=${COURSENUM};k=k+1));do if [[ -d ${COURSENAME[k]} ]];then echo "Dir ${COURSENAME[k]} already exist!";else mkdir ${COURSENAME[k]};fi;for((j=1;j<=${COURSEEP[k]};j=j+1));do if [[ -f ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts ]];then ffmpeg -i ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts -bsf:a aac_adtstoasc -acodec copy -vcodec copy ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.mp4;rm ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts;elif [[ ! -f ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.mp4 ]];then if((j<10&&COURSEID[k]<10000));then COURSE="http://wow01.ibrain.com.tw/vod//_definst_/ibrain/${COURSEID[k]}///mp4:65v00${COURSEID[k]}00${j}.mp4/playlist.m3u8";elif((j<10&&COURSEID[k]>= 10000));then COURSE="http://wow01.ibrain.com.tw/vod//_definst_/ibrain/${COURSEID[k]}///mp4:65v0${COURSEID[k]}00${j}.mp4/playlist.m3u8";elif((j>=10&&COURSEID[k]<10000));then COURSE="http://wow01.ibrain.com.tw/vod//_definst_/ibrain/${COURSEID[k]}///mp4:65v00${COURSEID[k]}0${j}.mp4/playlist.m3u8";else COURSE="http://wow01.ibrain.com.tw/vod//_definst_/ibrain/${COURSEID[k]}///mp4:65v0${COURSEID[k]}0${j}.mp4/playlist.m3u8";fi;mkdir ./${COURSENAME[k]}/downloading_第${j}堂;DIR="./${COURSENAME[k]}/downloading_第${j}堂";wget -O ${DIR}/playlist.m3u8 ${COURSE};LIST=`grep 'chunklist' ${DIR}/playlist.m3u8`;echo ${LIST};echo ${COURSE}>${DIR}/url.txt;URL=${COURSE%??????????????};echo ${URL}/{LIST};wget -O ${DIR}/${LIST} ${URL}/${LIST};LAST=`tail -n 2 ${DIR}/${LIST}|head -n 1`;echo ${LAST}>${DIR}/last.txt;NUM=`cat ${DIR}/last.txt|cut -d '_' -f 3|cut -d '.' -f 1`;echo ${NUM};MEDIA=`cat ${DIR}/last.txt|cut -d '_' -f 2`;for((i=0;i<=${NUM};i=i+1));do wget -O ${DIR}/media_${MEDIA}_${i}.ts ${URL}/media_${MEDIA}_${i}.ts;echo ${DIR}/media_${MEDIA}_${i}.ts|tr " " "\n">>${DIR}/tslist.txt;done;while read line;do cat $line>>./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts;done<${DIR}/tslist.txt;ffmpeg -i ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts -bsf:a aac_adtstoasc -acodec copy -vcodec copy ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.mp4;rm ./${COURSENAME[k]}/${COURSENAME[k]}_第${j}堂.ts;rm -rf ${DIR};else echo "File ${COURSENAME[k]}_第${j}堂.mp4 exist!";fi;done;done;if [ "${AUTOSHOOTDOWN}" == "Y" ]||[ "${AUTOSHOOTDOWN}" == "y" ];then shutdown -h now;elif [ "${AUTOSHOOTDOWN}" == "N" ]||[ "${AUTOSHOOTDOWN}" == "n" ];then echo "Download Done!";else echo "Download Done!";fi
